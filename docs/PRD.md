# 产品需求文档 (PRD)

> 本文档描述 Environment Fabric 的产品需求、目标用户和功能范围。

---

## 1. 产品概述

### 1.1 背景与问题

LangGraph 工作流中的每个节点可能需要执行不同的 Python 代码，这些代码依赖的第三方库版本可能存在冲突：

| 场景 | 问题示例 |
|------|----------|
| Node A | 需要 `numpy==1.24.0` |
| Node B | 需要 `numpy==2.0.0` |
| 冲突 | 共享环境下无法同时满足 |

### 1.2 产品目标

构建一个**节点级虚拟环境管理服务**，为每个 LangGraph 节点提供：

1. **独立的 Python 虚拟环境**
2. **依赖包的完整 CRUD 操作**
3. **通过 `pyproject.toml` + `uv.lock` 实现环境复现**
4. **环境生命周期管理**

### 1.3 范围声明

> [!CAUTION]
> **本系统仅解决依赖冲突问题，不提供安全沙箱功能**
> 
> - ✅ 解决：不同节点间的依赖版本冲突
> - ✅ 解决：环境可复现性（通过 lock 文件）
> - ❌ 不解决：恶意代码执行、资源限制、系统调用隔离
> 
> 如需安全沙箱，请使用 Docker、gVisor 或 Firecracker 等容器技术。

### 1.4 功能范围

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 创建环境 | P0 | 为节点创建独立 UV 项目 |
| 安装依赖 | P0 | 使用 `uv add` 添加依赖 |
| 添加依赖 | P0 | 动态添加单个/多个包 |
| 删除依赖 | P0 | 使用 `uv remove` 移除包 |
| 更新依赖 | P0 | 升级/降级包版本 |
| 查询依赖 | P0 | 从 `pyproject.toml` 读取依赖列表 |
| 删除环境 | P0 | 清理节点环境 |
| **导出环境** | P0 | 导出 `pyproject.toml` + `uv.lock` |
| **复现环境** | P0 | 从 lock 文件重建环境 |
| 环境状态 | P1 | 查询环境健康状态 |
| 执行代码 | P1 | 在环境中运行 Python 代码 |
| 自动清理 | P1 | 清理长期未使用的环境 |
